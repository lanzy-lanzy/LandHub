{% extends 'base.html' %}
{% load static %}

{% block title %}Notifications - LandHub{% endblock %}
{% block meta_description %}View and manage your notifications on LandHub{% endblock %}

{% block extra_css %}
<style>
    .notification-card {
        background: linear-gradient(135deg, rgba(255,255,255,0.9) 0%, rgba(255,255,255,0.95) 100%);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255,255,255,0.2);
        transition: all 0.3s ease;
    }
    
    .notification-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 25px rgba(0,0,0,0.1);
    }
    
    .notification-unread {
        border-left: 4px solid #3B82F6;
        background: linear-gradient(135deg, rgba(59, 130, 246, 0.05) 0%, rgba(59, 130, 246, 0.02) 100%);
    }
    
    .notification-read {
        border-left: 4px solid #E5E7EB;
    }
    
    .notification-type-badge {
        font-size: 0.75rem;
        font-weight: 600;
        padding: 0.25rem 0.75rem;
        border-radius: 9999px;
        text-transform: uppercase;
        letter-spacing: 0.05em;
    }
    
    .type-inquiry_new { background-color: #DBEAFE; color: #1E40AF; }
    .type-inquiry_response { background-color: #D1FAE5; color: #065F46; }
    .type-listing_approved { background-color: #D1FAE5; color: #065F46; }
    .type-listing_rejected { background-color: #FEE2E2; color: #991B1B; }
    .type-listing_pending { background-color: #FEF3C7; color: #92400E; }
    .type-property_favorited { background-color: #FCE7F3; color: #BE185D; }
    .type-system_welcome { background-color: #EDE9FE; color: #5B21B6; }
    .type-system_update { background-color: #F3F4F6; color: #374151; }
</style>
{% endblock %}

{% block content %}
<div class="bg-gradient-to-br from-gray-50 to-gray-100 min-h-screen">
    <!-- Header -->
    <div class="bg-white border-b border-gray-200 shadow-sm">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between py-6">
                <div>
                    <h1 class="text-2xl font-bold text-gray-900">Notifications</h1>
                    <p class="mt-1 text-sm text-gray-600">Stay updated with your LandHub activity</p>
                </div>
                <div class="flex items-center space-x-3">
                    {% if unread_count > 0 %}
                        <button hx-post="{% url 'notifications_mark_all_read' %}"
                                hx-target="#notifications-container"
                                hx-swap="innerHTML"
                                class="inline-flex items-center px-4 py-2 bg-primary-600 text-white rounded-lg text-sm font-medium hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition-all duration-200 shadow-sm">
                            <svg class="w-4 h-4 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                            </svg>
                            Mark All Read
                        </button>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Filters -->
        <div class="notification-card rounded-xl shadow-sm p-6 mb-8">
            <form method="get" hx-get="{% url 'notifications_list' %}" hx-target="#notifications-container" hx-trigger="change">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div>
                        <label for="type" class="block text-sm font-medium text-gray-700 mb-2">Type</label>
                        <select name="type" id="type" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent">
                            <option value="">All Types</option>
                            {% for value, label in notification_types %}
                                <option value="{{ value }}" {% if current_type == value %}selected{% endif %}>{{ label }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div>
                        <label for="read" class="block text-sm font-medium text-gray-700 mb-2">Status</label>
                        <select name="read" id="read" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent">
                            <option value="">All</option>
                            <option value="false" {% if current_read == 'false' %}selected{% endif %}>Unread</option>
                            <option value="true" {% if current_read == 'true' %}selected{% endif %}>Read</option>
                        </select>
                    </div>
                    <div class="flex items-end">
                        <button type="submit" class="w-full px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors duration-200">
                            Filter
                        </button>
                    </div>
                </div>
            </form>
        </div>

        <!-- Statistics -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
            <div class="notification-card rounded-xl shadow-sm p-6 text-center">
                <div class="text-3xl font-bold text-blue-600">{{ total_notifications }}</div>
                <div class="text-sm text-gray-600 mt-1">Total Notifications</div>
            </div>
            <div class="notification-card rounded-xl shadow-sm p-6 text-center">
                <div class="text-3xl font-bold text-orange-600">{{ unread_count }}</div>
                <div class="text-sm text-gray-600 mt-1">Unread</div>
            </div>
            <div class="notification-card rounded-xl shadow-sm p-6 text-center">
                <div class="text-3xl font-bold text-green-600">{{ total_notifications|add:"-"|add:unread_count }}</div>
                <div class="text-sm text-gray-600 mt-1">Read</div>
            </div>
        </div>

        <!-- Notifications List -->
        <div id="notifications-container">
            {% include 'components/notifications_list.html' %}
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Auto-refresh notifications every 30 seconds
    setInterval(function() {
        htmx.trigger('#notifications-container', 'refresh');
    }, 30000);
    
    // Handle notification actions
    document.addEventListener('htmx:afterRequest', function(event) {
        if (event.detail.xhr.status === 200 && event.detail.target.id === 'notifications-container') {
            // Update notification count in header if it exists
            const countElement = document.querySelector('#notification-count');
            if (countElement) {
                htmx.trigger(countElement, 'refresh');
            }
        }
    });
</script>
{% endblock %}
